version: 1
applications:
  - appRoot: b2b-simple
    frontend:
      phases:
        preBuild:
          commands:
            - nvm use 20 || . ~/.nvm/nvm.sh && nvm install 20 && nvm use 20
            - node -v
            - npm install --no-fund --no-audit
        build:
          commands:
            - printf "%s\n" \
                "CT_PROJECT_KEY=$CT_PROJECT_KEY" \
                "CT_CLIENT_ID=$CT_CLIENT_ID" \
                "CT_CLIENT_SECRET=$CT_CLIENT_SECRET" \
                "CT_AUTH_URL=$CT_AUTH_URL" \
                "CT_API_URL=$CT_API_URL" \
                "CT_SCOPE=$CT_SCOPE" \
                "CT_SCOPES=$CT_SCOPES" \
                "CT_HOST=$CT_HOST" \
                "CT_STORE_KEY=$CT_STORE_KEY" \
                "FRONTEND_BASE_URL=$FRONTEND_BASE_URL" > .env.production
            - npm run build
      artifacts:
        baseDirectory: .next
        files:
          - "**/*"
      cache:
        paths:
          - node_modules/**/*
          - .next/cache/**/*
